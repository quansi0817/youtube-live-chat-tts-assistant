<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube èŠå¤©æŠ“å– - ä¸€é”®å®‰è£…</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #e62117;
            border-bottom: 3px solid #e62117;
            padding-bottom: 10px;
        }
        .step {
            background: #f9f9f9;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #4285f4;
            border-radius: 4px;
        }
        .step h3 {
            margin-top: 0;
            color: #4285f4;
        }
        button {
            background: #4285f4;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            background: #3367d6;
        }
        button.success {
            background: #0f9d58;
        }
        button.danger {
            background: #e62117;
        }
        code {
            background: #f0f0f0;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.5;
            margin: 10px 0;
        }
        .warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
        }
        .success-msg {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 15px 0;
            display: none;
        }
        a {
            color: #4285f4;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“º YouTube ç›´æ’­èŠå¤©æŠ“å–å·¥å…·</h1>

        <p>è¿™ä¸ªå·¥å…·å¯ä»¥å®Œæ•´æŠ“å– YouTube ç›´æ’­èŠå¤©ï¼ŒåŒ…æ‹¬æ–‡å­—ã€è¡¨æƒ…ã€Super Chat ç­‰ï¼Œå¹¶ä¿æŒåŸæ ·æ˜¾ç¤ºï¼</p>

        <div class="warning">
            âš ï¸ <strong>é‡è¦æç¤ºï¼š</strong>ä¸è¦ä½¿ç”¨æµè§ˆå™¨æ‰©å±•æ–¹å¼ï¼è¯·æŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤æ‰‹åŠ¨æ“ä½œï¼Œæ›´ç®€å•å¯é ã€‚
        </div>

        <div class="step">
            <h3>æ­¥éª¤ 1: æ‰“å¼€ YouTube ç›´æ’­èŠå¤©</h3>
            <p>1. æ‰¾ä¸€ä¸ªæ­£åœ¨ç›´æ’­çš„ YouTube é¢‘é“</p>
            <p>2. åœ¨èŠå¤©çª—å£ç‚¹å‡»å¼¹å‡ºæŒ‰é’®ï¼ˆç‹¬ç«‹çª—å£å›¾æ ‡ï¼‰ï¼Œæˆ–è€…æ‰‹åŠ¨è®¿é—®ï¼š</p>
            <code>https://www.youtube.com/live_chat?is_popout=1&v=è§†é¢‘ID</code>
            <p style="margin-top: 10px;">
                <button onclick="window.open('https://www.youtube.com/results?search_query=live&sp=EgJAAQ%253D%253D', '_blank')">
                    ğŸ” æ‰“å¼€ YouTube æ‰¾ç›´æ’­
                </button>
            </p>
        </div>

        <div class="step">
            <h3>æ­¥éª¤ 2: å¤åˆ¶å¹¶è¿è¡Œè„šæœ¬</h3>
            <p>1. åœ¨èŠå¤©é¡µé¢æŒ‰ <code>F12</code> æ‰“å¼€å¼€å‘è€…å·¥å…·</p>
            <p>2. åˆ‡æ¢åˆ° <strong>Consoleï¼ˆæ§åˆ¶å°ï¼‰</strong> æ ‡ç­¾</p>
            <p>3. ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®å¤åˆ¶è„šæœ¬ï¼š</p>
            <button id="copyBtn" onclick="copyScript()">ğŸ“‹ å¤åˆ¶è„šæœ¬åˆ°å‰ªè´´æ¿</button>
            <div id="success" class="success-msg">âœ… è„šæœ¬å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼ç°åœ¨ç²˜è´´åˆ° YouTube èŠå¤©é¡µé¢çš„æ§åˆ¶å°ä¸­å¹¶æŒ‰å›è½¦ã€‚</div>
            <p>4. ç²˜è´´åˆ°æ§åˆ¶å°å¹¶æŒ‰å›è½¦</p>
        </div>

        <div class="step">
            <h3>æ­¥éª¤ 3: æ‰“å¼€èŠå¤©æ˜¾ç¤ºé¡µé¢</h3>
            <p>åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€ï¼š</p>
            <code id="chatHtmlPath"></code>
            <p style="margin-top: 10px;">
                <button onclick="openChatPage()">ğŸš€ æ‰“å¼€èŠå¤©æ˜¾ç¤ºé¡µé¢</button>
            </p>
        </div>

        <div class="step">
            <h3>âœ… å®Œæˆï¼</h3>
            <p>ç°åœ¨èŠå¤©æ¶ˆæ¯åº”è¯¥ä¼šè‡ªåŠ¨æ˜¾ç¤ºåœ¨é¡µé¢ä¸­ï¼ŒåŒ…æ‹¬ï¼š</p>
            <ul>
                <li>âœ… æ™®é€šæ–‡å­—æ¶ˆæ¯ï¼ˆå¸¦è¡¨æƒ…ï¼‰</li>
                <li>âœ… Super Chatï¼ˆæ‰“èµï¼Œå¸¦é¢œè‰²ï¼‰</li>
                <li>âœ… Super Stickerï¼ˆä»˜è´¹è´´çº¸ï¼‰</li>
                <li>âœ… ä¼šå‘˜æ¶ˆæ¯</li>
                <li>âœ… ç”¨æˆ·å¤´åƒå’Œæ—¶é—´æˆ³</li>
            </ul>
            <p>ç‚¹å‡»ä»»ä½•æ¶ˆæ¯å³å¯ TTS æœ—è¯»ï¼</p>
        </div>

        <hr style="margin: 30px 0;">

        <h2>ğŸ› é‡åˆ°é—®é¢˜ï¼Ÿ</h2>
        <div class="step">
            <h3>é—®é¢˜1: æ§åˆ¶å°æç¤ºé”™è¯¯</h3>
            <p>ç¡®ä¿ä½ åœ¨ <strong>YouTube ç›´æ’­èŠå¤©é¡µé¢</strong>ï¼ˆlive_chatï¼‰è¿è¡Œè„šæœ¬ï¼Œä¸æ˜¯æ™®é€šè§†é¢‘é¡µé¢ã€‚</p>
        </div>

        <div class="step">
            <h3>é—®é¢˜2: æ²¡æœ‰æ¶ˆæ¯æ˜¾ç¤º</h3>
            <p>1. ç¡®ä¿ç›´æ’­æœ‰èŠå¤©æ¶ˆæ¯</p>
            <p>2. åœ¨èŠå¤©æ˜¾ç¤ºé¡µé¢æŒ‰ F12ï¼ŒæŸ¥çœ‹æ§åˆ¶å°æ˜¯å¦æœ‰"YouTube Chat Display å·²åŠ è½½"</p>
            <p>3. åˆ·æ–°ä¸¤ä¸ªé¡µé¢é‡è¯•</p>
        </div>

        <div class="step">
            <h3>é—®é¢˜3: è¡¨æƒ…ä¸æ˜¾ç¤º</h3>
            <p>æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼Œè¡¨æƒ…å›¾ç‰‡éœ€è¦ä» YouTube æœåŠ¡å™¨åŠ è½½ã€‚</p>
        </div>
    </div>

    <script id="scraperScript">
        // è·å–è„šæœ¬æ–‡ä»¶çš„è·¯å¾„
        const currentPath = window.location.pathname;
        const basePath = currentPath.substring(0, currentPath.lastIndexOf('/'));
        const chatHtmlPath = window.location.origin + basePath + '/src/html/simple-chat.html';
        document.getElementById('chatHtmlPath').textContent = chatHtmlPath;

        function copyScript() {
            // è¿™é‡Œæ˜¯å®Œæ•´çš„æŠ“å–è„šæœ¬
            const script = `(function() {
    'use strict';

    if (window.YouTubeChatTTSInstalled) {
        console.log('è„šæœ¬å·²ç»å®‰è£…ï¼Œæ— éœ€é‡å¤è¿è¡Œï¼');
        return;
    }
    window.YouTubeChatTTSInstalled = true;

    console.log('ğŸš€ YouTube èŠå¤©æŠ“å–è„šæœ¬å¼€å§‹è¿è¡Œ...');

    function scrapeMessage(element) {
        try {
            const tagName = element.tagName.toLowerCase();
            const messageType = tagName.replace('yt-live-chat-', '').replace('-renderer', '');

            const authorElement = element.querySelector('#author-name');
            const authorPhotoElement = element.querySelector('#author-photo img, #img');
            const messageElement = element.querySelector('#message, #content-text, #purchase-amount-column');
            const timeElement = element.querySelector('#timestamp');
            const timestamp = timeElement ? timeElement.textContent : new Date().toLocaleTimeString();

            const author = authorElement ? (authorElement.innerText || authorElement.textContent || '').trim() : '';
            const authorPhoto = authorPhotoElement ? authorPhotoElement.src : '';

            const messageId = element.id || element.getAttribute('data-message-id') ||
                             \`\${author}_\${timestamp}_\${Date.now()}_\${Math.random()}\`;

            let messageData = {
                id: messageId,
                author: author,
                authorPhoto: authorPhoto,
                timestamp: timestamp,
                type: messageType,
                html: element.innerHTML,
                element: element.outerHTML
            };

            if (tagName === 'yt-live-chat-text-message-renderer') {
                messageData.message = messageElement ? messageElement.innerText : '';
                messageData.messageHtml = messageElement ? messageElement.innerHTML : '';
            }
            else if (tagName === 'yt-live-chat-paid-message-renderer') {
                const purchaseAmount = element.querySelector('#purchase-amount');
                const messageContent = element.querySelector('#message, yt-formatted-string');

                messageData.message = messageContent ? messageContent.innerText : '';
                messageData.messageHtml = messageContent ? messageContent.innerHTML : '';
                messageData.purchaseAmount = purchaseAmount ? purchaseAmount.textContent : '';
                messageData.isSuperChat = true;

                const cardElement = element.querySelector('#card');
                if (cardElement) {
                    const style = window.getComputedStyle(cardElement);
                    messageData.backgroundColor = style.backgroundColor;
                }
            }
            else if (tagName === 'yt-live-chat-paid-sticker-renderer') {
                const purchaseAmount = element.querySelector('#purchase-amount-chip');
                const stickerImg = element.querySelector('#sticker img');

                messageData.purchaseAmount = purchaseAmount ? purchaseAmount.textContent : '';
                messageData.stickerUrl = stickerImg ? stickerImg.src : '';
                messageData.isSuperSticker = true;
            }
            else if (tagName === 'yt-live-chat-membership-item-renderer') {
                const headerPrimary = element.querySelector('#header-primary-text');
                const headerSub = element.querySelector('#header-subtext');
                const messageContent = element.querySelector('#message');

                messageData.headerPrimary = headerPrimary ? headerPrimary.innerText : '';
                messageData.headerSub = headerSub ? headerSub.innerText : '';
                messageData.message = messageContent ? messageContent.innerText : '';
                messageData.messageHtml = messageContent ? messageContent.innerHTML : '';
                messageData.isMembership = true;
            }
            else {
                const textContent = element.innerText || element.textContent || '';
                messageData.message = textContent.trim();
            }

            return messageData;
        } catch (e) {
            console.error('Error scraping message:', e);
            return null;
        }
    }

    function sendMessage(data) {
        try {
            localStorage.setItem('youtubeChatMessage', JSON.stringify({
                type: 'YOUTUBE_CHAT_MESSAGE',
                data: data,
                timestamp: Date.now()
            }));

            try {
                const channel = new BroadcastChannel('youtube-chat-tts');
                channel.postMessage({
                    type: 'YOUTUBE_CHAT_MESSAGE',
                    data: data
                });
            } catch (e) {}

            try {
                window.postMessage({
                    type: 'YOUTUBE_CHAT_MESSAGE',
                    data: data
                }, '*');
            } catch (e) {}

            window.dispatchEvent(new CustomEvent('youtubeChatMessage', {
                detail: data
            }));

            console.log('âœ… æ¶ˆæ¯å·²æŠ“å–:', data.author, '-', data.message);
        } catch (e) {
            console.error('å‘é€æ¶ˆæ¯å¤±è´¥:', e);
        }
    }

    function initScraper() {
        const chatContainer = document.querySelector('yt-live-chat-app #items.yt-live-chat-item-list-renderer');

        if (!chatContainer) {
            console.warn('â³ ç­‰å¾…èŠå¤©å®¹å™¨åŠ è½½...');
            if (!window.scraperRetryCount) {
                window.scraperRetryCount = 0;
            }
            window.scraperRetryCount++;

            if (window.scraperRetryCount > 10) {
                console.error('âŒ æ— æ³•æ‰¾åˆ°èŠå¤©å®¹å™¨ã€‚è¯·ç¡®ä¿è¿™æ˜¯ä¸€ä¸ªç›´æ’­èŠå¤©é¡µé¢ï¼');
                return;
            }
            setTimeout(initScraper, 1000);
            return;
        }

        window.scraperRetryCount = 0;
        console.log('âœ… èŠå¤©å®¹å™¨å·²æ‰¾åˆ°ï¼Œå¼€å§‹ç›‘å¬æ¶ˆæ¯...');

        const messageSelectors = [
            'yt-live-chat-text-message-renderer',
            'yt-live-chat-paid-message-renderer',
            'yt-live-chat-paid-sticker-renderer',
            'yt-live-chat-membership-item-renderer',
            'yt-live-chat-legacy-paid-message-renderer'
        ];

        messageSelectors.forEach(selector => {
            const existingMessages = chatContainer.querySelectorAll(selector);
            existingMessages.forEach(msg => {
                const data = scrapeMessage(msg);
                if (data) {
                    sendMessage(data);
                }
            });
        });

        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                mutation.addedNodes.forEach((node) => {
                    if (node.nodeType === 1) {
                        const tagName = node.tagName;

                        const isMessageElement = messageSelectors.some(selector =>
                            tagName === selector.toUpperCase()
                        );

                        if (isMessageElement) {
                            setTimeout(() => {
                                const data = scrapeMessage(node);
                                if (data) {
                                    sendMessage(data);
                                }
                            }, 100);
                        } else if (node.querySelector) {
                            messageSelectors.forEach(selector => {
                                const target = node.querySelector(selector);
                                if (target) {
                                    setTimeout(() => {
                                        const data = scrapeMessage(target);
                                        if (data) {
                                            sendMessage(data);
                                        }
                                    }, 100);
                                }
                            });
                        }
                    }
                });
            });
        });

        observer.observe(chatContainer, {
            childList: true,
            subtree: true
        });

        window.youtubeChatObserver = observer;
        console.log('ğŸ‰ è„šæœ¬å®‰è£…æˆåŠŸï¼ç°åœ¨æ‰“å¼€èŠå¤©æ˜¾ç¤ºé¡µé¢æŸ¥çœ‹æ¶ˆæ¯ã€‚');
    }

    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initScraper);
    } else {
        initScraper();
    }

})();`;

            // å¤åˆ¶åˆ°å‰ªè´´æ¿
            navigator.clipboard.writeText(script).then(() => {
                document.getElementById('success').style.display = 'block';
                document.getElementById('copyBtn').textContent = 'âœ… å·²å¤åˆ¶ï¼';
                document.getElementById('copyBtn').classList.add('success');

                setTimeout(() => {
                    document.getElementById('copyBtn').textContent = 'ğŸ“‹ å¤åˆ¶è„šæœ¬åˆ°å‰ªè´´æ¿';
                    document.getElementById('copyBtn').classList.remove('success');
                }, 3000);
            }).catch(err => {
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶è„šæœ¬');
                console.error('å¤åˆ¶å¤±è´¥:', err);
            });
        }

        function openChatPage() {
            window.open(chatHtmlPath, '_blank');
        }
    </script>
</body>
</html>
